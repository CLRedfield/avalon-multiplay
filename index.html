<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Avalon - 多人在线投票推理游戏">
    <title>Avalon - 阿瓦隆</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>

<body>
    <div id="app">
        <!-- 首页 -->
        <div id="home-view" class="view active">
            <div class="container">
                <div class="logo">
                    <h1>🏰 Avalon</h1>
                    <p class="subtitle">阿瓦隆 - 多人投票推理游戏</p>
                </div>

                <div class="glass card">
                    <input type="text" id="player-name" placeholder="输入你的昵称" maxlength="12">
                    <button id="create-room-btn" class="btn btn-primary">
                        <span>创建房间</span>
                    </button>

                    <div class="divider"><span>或</span></div>

                    <input type="text" id="room-code" placeholder="输入房间号" maxlength="4">
                    <button id="join-room-btn" class="btn btn-secondary">
                        <span>加入房间</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 大厅 -->
        <div id="lobby-view" class="view">
            <div class="container">
                <div class="room-header">
                    <h2>房间</h2>
                    <span id="display-room-code">----</span>
                    <button id="copy-code-btn" class="btn-icon">📋</button>
                </div>

                <div class="glass card">
                    <h3>玩家列表 <span id="player-count">(0/10)</span></h3>
                    <ul id="player-list" class="player-list"></ul>
                </div>

                <!-- 房主面板 -->
                <div id="host-panel" class="glass card" style="display: none;">
                    <h4>中立角色池</h4>
                    <p class="hint">至少选择一个，游戏会随机选择其一</p>
                    <div class="role-toggles">
                        <label class="toggle-item">
                            <input type="checkbox" id="neutral-scapegoat" checked>
                            <span class="toggle-label">🐑 替罪羊</span>
                        </label>
                        <label class="toggle-item">
                            <input type="checkbox" id="neutral-armsdealer" checked>
                            <span class="toggle-label">🔫 军火商</span>
                        </label>
                        <label class="toggle-item">
                            <input type="checkbox" id="neutral-cultist" checked>
                            <span class="toggle-label">🔥 狂热者</span>
                        </label>
                    </div>
                    <button id="start-game-btn" class="btn btn-success" disabled>
                        <span>开始游戏 (需要5人)</span>
                    </button>
                </div>

                <!-- 非房主面板 -->
                <div id="guest-panel" class="glass card" style="display: none;">
                    <p class="waiting-text">等待房主开始游戏...</p>
                </div>

                <button id="leave-room-btn" class="btn btn-secondary">
                    <span>退出房间</span>
                </button>
            </div>
        </div>

        <!-- 角色查看 -->
        <div id="role-view" class="view">
            <div class="container">
                <div class="role-reveal">
                    <div id="my-role-card" class="glass role-card">
                        <div id="role-icon" class="role-icon">❓</div>
                        <h2 id="role-name">点击查看身份</h2>
                        <p id="role-description" class="role-desc"></p>
                        <div id="role-info" class="role-info"></div>
                    </div>
                    <button id="ready-btn" class="btn btn-primary" style="display: none; margin-top: 20px;">
                        <span>我已记住，准备开始</span>
                    </button>
                </div>

                <div id="ready-status" class="glass card"></div>
                <p id="ready-progress" style="text-align: center; color: var(--text-secondary);"></p>
            </div>
        </div>

        <!-- 游戏主界面 -->
        <div id="game-view" class="view">
            <div class="container">
                <!-- 任务进度 -->
                <div class="mission-track">
                    <div id="mission-1" class="mission"><span>2</span></div>
                    <div id="mission-2" class="mission"><span>3</span></div>
                    <div id="mission-3" class="mission"><span>2</span></div>
                    <div id="mission-4" class="mission"><span>3</span></div>
                    <div id="mission-5" class="mission"><span>3</span></div>
                </div>

                <!-- 否决次数 -->
                <div class="reject-track">
                    <span>否决:</span>
                    <div class="reject-markers">
                        <div id="reject-1" class="reject-marker"></div>
                        <div id="reject-2" class="reject-marker"></div>
                        <div id="reject-3" class="reject-marker"></div>
                        <div id="reject-4" class="reject-marker"></div>
                        <div id="reject-5" class="reject-marker"></div>
                    </div>
                </div>

                <!-- 游戏状态 -->
                <div class="glass card game-status">
                    <p id="game-status-text">队长选择队伍</p>
                    <p id="captain-info" class="captain-info"></p>
                </div>

                <!-- 玩家区域 -->
                <div id="game-players" class="game-players"></div>

                <!-- 操作面板 -->
                <div id="action-panel" class="glass card action-panel"></div>

                <!-- 审判官按钮 -->
                <button id="inquisitor-btn" class="inquisitor-btn" style="display: none;">
                    🔍 使用审判官技能
                </button>
            </div>
        </div>

        <!-- 投票界面 -->
        <div id="vote-view" class="view">
            <div class="container">
                <div class="glass card vote-card">
                    <h2 id="vote-title">队伍表决</h2>
                    <p id="vote-description">是否同意此次任务队伍出发？</p>
                    <div id="vote-team" class="vote-team"></div>
                    <div class="vote-buttons">
                        <button id="vote-approve" class="btn btn-success">
                            <span>👍 赞成</span>
                        </button>
                        <button id="vote-reject" class="btn btn-danger">
                            <span>👎 反对</span>
                        </button>
                    </div>
                    <div id="vote-waiting" class="vote-waiting" style="display: none;">
                        <p>等待其他玩家投票...</p>
                        <p class="vote-progress"><span id="votes-cast">0</span>/<span id="votes-total">0</span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 投票结果 -->
        <div id="vote-result-view" class="view">
            <div class="container">
                <div class="glass card vote-result-card">
                    <h2>投票结果</h2>
                    <p id="vote-result-status"></p>
                    <div class="vote-result-lists">
                        <div class="vote-result-column approve">
                            <h4>👍 赞成</h4>
                            <ul id="vote-approve-list"></ul>
                        </div>
                        <div class="vote-result-column reject">
                            <h4>👎 反对</h4>
                            <ul id="vote-reject-list"></ul>
                        </div>
                    </div>
                    <div class="vote-countdown">
                        <span id="vote-countdown-num">5</span> 秒后继续...
                    </div>
                </div>
            </div>
        </div>

        <!-- 任务界面 -->
        <div id="mission-view" class="view">
            <div class="container">
                <div class="glass card mission-card">
                    <h2>🎯 执行任务</h2>
                    <p id="mission-instruction">你正在执行此次任务</p>
                    <div class="mission-buttons">
                        <button id="mission-success" class="btn btn-success">
                            <span>✅ 任务成功</span>
                        </button>
                        <button id="mission-fail" class="btn btn-danger">
                            <span>❌ 破坏任务</span>
                        </button>
                    </div>
                    <div id="mission-waiting" class="vote-waiting" style="display: none;">
                        <p>等待任务队员完成任务...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 任务结果 -->
        <div id="mission-result-view" class="view">
            <div class="container">
                <div class="glass card mission-result-card">
                    <h2 id="mission-result-title">任务结果</h2>
                    <p id="mission-result-status"></p>
                    <div class="vote-result-lists">
                        <div class="vote-result-column approve">
                            <h4>✅ 成功</h4>
                            <p id="mission-success-count" class="mission-result-num">0</p>
                        </div>
                        <div class="vote-result-column reject">
                            <h4>❌ 失败</h4>
                            <p id="mission-fail-count" class="mission-result-num">0</p>
                        </div>
                    </div>
                    <div class="vote-countdown">
                        <span id="mission-countdown-num">5</span> 秒后继续...
                    </div>
                </div>
            </div>
        </div>

        <!-- 放逐会议 -->
        <div id="tribunal-view" class="view">
            <div class="container">
                <div class="glass card tribunal-card">
                    <h2>⚖️ 放逐会议</h2>
                    <p id="tribunal-phase">选择一名玩家进行放逐</p>
                    <div id="tribunal-players" class="tribunal-players"></div>
                </div>
            </div>
        </div>

        <!-- 刺客界面 -->
        <div id="assassin-view" class="view">
            <div class="container">
                <div class="glass card assassin-card">
                    <h2>🗡️ 刺客行动</h2>
                    <p id="assassin-instruction"></p>
                    <div id="assassin-targets" class="assassin-targets"></div>
                    <div id="assassin-waiting" class="vote-waiting" style="display: none;">
                        <p>等待刺客选择目标...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 游戏结果 -->
        <div id="result-view" class="view">
            <div class="container">
                <div class="glass card result-card">
                    <h2 id="result-title">游戏结束</h2>
                    <p id="result-description"></p>
                    <div id="all-roles" class="all-roles"></div>
                    <div id="neutral-results" class="neutral-results"></div>
                    <div id="result-countdown" class="vote-countdown" style="margin-top: 20px;">
                        <span id="result-countdown-num">5</span> 秒后返回大厅...
                    </div>
                </div>
            </div>
        </div>

        <!-- 角色信息面板（固定悬浮） -->
        <div id="role-info-panel" class="role-info-panel" style="display: none;">
            <div class="role-info-header" onclick="App.toggleRolePanel()">
                <span id="role-panel-icon">?</span>
                <span id="role-panel-name">角色</span>
            </div>
            <div class="role-info-body">
                <p id="role-panel-desc"></p>
            </div>
        </div>

        <!-- Toast 提示 -->
        <div id="toast" class="toast"></div>

        <!-- 审判官弹窗 -->
        <div id="inquisitor-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h3>🔍 选择查看目标</h3>
                <p>选择一名玩家，查看其上一轮的任务投票</p>
                <div id="inquisitor-targets" class="inquisitor-targets"></div>
                <button id="inquisitor-cancel" class="btn btn-secondary" style="margin-top: 16px;">取消</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/roles.js"></script>
    <script src="js/room-manager.js"></script>
    <script src="js/game.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>

</html>